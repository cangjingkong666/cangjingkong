<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>网络性能测试工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 p-4 md:p-6">
    <div class="max-w-5xl mx-auto bg-white rounded-lg shadow-md p-5">
        <h1 class="text-2xl md:text-3xl font-bold text-center text-blue-600 mb-6">网络性能综合测试工具</h1>
        
        <!-- 功能四：IP与DNS地址检测 -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">1. 基础网络信息检测</h2>
            <button onclick="testIPAndDNS()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded mb-4 transition">开始检测IP与DNS</button>
            <div id="ipDnsResult" class="bg-gray-50 p-3 rounded min-h-[80px] whitespace-pre-wrap"></div>
        </section>

        <!-- 功能一：DNS服务器测试 -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">2. DNS服务器连通性与延迟测试</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block mb-1 font-medium">DNS协议类型</label>
                    <select id="dnsProtocol" class="w-full p-2 border rounded">
                        <option value="udp">UDP (默认)</option>
                        <option value="tcp">TCP</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-1 font-medium">DNS服务器地址</label>
                    <select id="dnsServer" class="w-full p-2 border rounded">
                        <option value="114.114.114.114">国内-114 DNS</option>
                        <option value="223.5.5.5">国内-阿里DNS</option>
                        <option value="8.8.8.8">国外-Google DNS</option>
                        <option value="1.1.1.1">国外-Cloudflare DNS</option>
                    </select>
                </div>
            </div>
            <button onclick="testDNS()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded mb-4 transition">开始DNS测试</button>
            <div id="dnsResult" class="bg-gray-50 p-3 rounded min-h-[80px] whitespace-pre-wrap"></div>
        </section>

        <!-- 功能二：HTTP协议版本测试 -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">3. HTTP协议版本连通性与延迟测试</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block mb-1 font-medium">HTTP协议版本</label>
                    <select id="httpVersion" class="w-full p-2 border rounded">
                        <option value="http/1.1">HTTP/1.1</option>
                        <option value="h2">HTTP/2</option>
                        <option value="h3">HTTP/3</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-1 font-medium">测试站点类型</label>
                    <select id="httpSiteType" class="w-full p-2 border rounded">
                        <option value="domestic">国内站点 (百度)</option>
                        <option value="foreign">国外站点 (Google)</option>
                    </select>
                </div>
            </div>
            <button onclick="testHTTP()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded mb-4 transition">开始HTTP测试</button>
            <div id="httpResult" class="bg-gray-50 p-3 rounded min-h-[80px] whitespace-pre-wrap"></div>
        </section>

        <!-- 功能三：网址延迟测试 -->
        <section>
            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">4. 网址域名延迟测试</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block mb-1 font-medium">测试网址</label>
                    <input type="text" id="testUrl" placeholder="例如: https://www.baidu.com" class="w-full p-2 border rounded" value="https://www.baidu.com">
                </div>
                <div>
                    <label class="block mb-1 font-medium">网址类型</label>
                    <select id="urlType" onchange="setDefaultUrl()" class="w-full p-2 border rounded">
                        <option value="domestic">国内网址</option>
                        <option value="foreign">国外网址</option>
                    </select>
                </div>
            </div>
            <button onclick="testUrlLatency()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded mb-4 transition">开始网址延迟测试</button>
            <div id="urlResult" class="bg-gray-50 p-3 rounded min-h-[80px] whitespace-pre-wrap"></div>
        </section>
    </div>

    <script>
        // 功能四：获取IP与DNS信息
        async function testIPAndDNS() {
            const resultEl = document.getElementById('ipDnsResult');
            resultEl.textContent = "正在检测...";
            try {
                // 获取公网IP（借助第三方API）
                const ipRes = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipRes.json();
                const publicIP = ipData.ip;

                // 获取DNS信息（浏览器端无法直接获取系统DNS，此处用公共API模拟）
                const dnsRes = await fetch('https://cloudflare-dns.com/dns-query?name=example.com&type=A', {
                    headers: { 'Accept': 'application/dns-json' }
                });
                const dnsData = await dnsRes.json();
                const dnsServer = dnsRes.url.split('//')[1].split('/')[0];

                resultEl.textContent = `公网IP地址: ${publicIP}\n当前使用DNS服务器: ${dnsServer}\n（注：浏览器端仅能获取解析用DNS，非系统全部DNS）`;
            } catch (err) {
                resultEl.textContent = `检测失败: ${err.message}`;
            }
        }

        // 功能一：DNS测试（借助第三方API模拟，浏览器端无法直接发送DNS请求）
        async function testDNS() {
            const resultEl = document.getElementById('dnsResult');
            const protocol = document.getElementById('dnsProtocol').value;
            const server = document.getElementById('dnsServer').value;
            resultEl.textContent = "正在测试DNS...";

            try {
                const start = performance.now();
                // 用DNS查询API模拟测试
                const res = await fetch(`https://dns.google/resolve?name=baidu.com&server=${server}&type=A`, {
                    headers: { 'Accept': 'application/json' }
                });
                const data = await res.json();
                const end = performance.now();
                const delay = (end - start).toFixed(2);

                if (data.Status === 0) {
                    resultEl.textContent = `DNS测试成功（${protocol}协议）\n服务器: ${server}\n延迟: ${delay}ms\n解析IP: ${data.Answer[0].data}`;
                } else {
                    resultEl.textContent = `DNS测试失败（${protocol}协议）\n服务器: ${server}\n错误码: ${data.Status}`;
                }
            } catch (err) {
                resultEl.textContent = `DNS测试异常: ${err.message}`;
            }
        }

        // 功能二：HTTP协议版本测试
        async function testHTTP() {
            const resultEl = document.getElementById('httpResult');
            const version = document.getElementById('httpVersion').value;
            const siteType = document.getElementById('httpSiteType').value;
            const url = siteType === 'domestic' ? 'https://www.baidu.com' : 'https://www.google.com';
            resultEl.textContent = `正在测试${version.toUpperCase()}协议（${siteType === 'domestic' ? '国内' : '国外'}站点）...`;

            try {
                const start = performance.now();
                const res = await fetch(url, {
                    headers: { 'Accept': 'text/html' },
                    mode: 'cors'
                });
                const end = performance.now();
                const delay = (end - start).toFixed(2);
                const actualVersion = res.protocol.replace('http/', 'HTTP/');

                resultEl.textContent = `${actualVersion}协议测试成功\n站点: ${url}\n延迟: ${delay}ms\n响应状态: ${res.status}`;
            } catch (err) {
                resultEl.textContent = `${version.toUpperCase()}协议测试失败\n站点: ${url}\n原因: ${err.message}`;
            }
        }

        // 功能三：网址延迟测试辅助 - 设置默认网址
        function setDefaultUrl() {
            const type = document.getElementById('urlType').value;
            const input = document.getElementById('testUrl');
            input.value = type === 'domestic' ? 'https://www.baidu.com' : 'https://www.google.com';
        }

        // 功能三：网址延迟测试
        async function testUrlLatency() {
            const resultEl = document.getElementById('urlResult');
            const url = document.getElementById('testUrl').value;
            if (!url.startsWith('http')) {
                resultEl.textContent = "请输入完整网址（需包含http/https）";
                return;
            }
            resultEl.textContent = `正在测试网址延迟: ${url}...`;

            try {
                const start = performance.now();
                const res = await fetch(url, { mode: 'cors' });
                const end = performance.now();
                const delay = (end - start).toFixed(2);

                resultEl.textContent = `网址延迟测试成功\n网址: ${url}\n延迟: ${delay}ms\n响应状态: ${res.status}`;
            } catch (err) {
                resultEl.textContent = `网址延迟测试失败\n网址: ${url}\n原因: ${err.message}`;
            }
        }
    </script>
</body>
</html>
