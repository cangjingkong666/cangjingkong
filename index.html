<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>网络测试工具集</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .page { display: none; }
        .page.active { display: block; }
        .test-item { margin-bottom: 1rem; padding: 0.8rem; border-radius: 0.5rem; background-color: #f8fafc; }
        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 p-4 md:p-6">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md p-5">
        <!-- 导航栏 -->
        <nav class="mb-8 flex flex-wrap gap-3">
            <button onclick="switchPage('page1')" class="nav-btn bg-blue-500 text-white py-2 px-4 rounded transition">页面1：DNS全面测试</button>
            <button onclick="switchPage('page2')" class="nav-btn bg-gray-200 text-gray-700 py-2 px-4 rounded transition">页面2：网址延迟测试</button>
            <button onclick="switchPage('page3')" class="nav-btn bg-gray-200 text-gray-700 py-2 px-4 rounded transition">页面3：IP与DNS归属地</button>
        </nav>

        <!-- 页面1：DNS服务器测试（多地址+多协议） -->
        <div id="page1" class="page active">
            <h2 class="text-xl font-bold text-blue-600 mb-4">DNS服务器连通性与延迟测试</h2>
            <p class="text-gray-600 mb-4">一键测试所有主流DNS服务器（UDP/TCP双协议）</p>
            <button onclick="testAllDNS()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded mb-6 transition">开始全面DNS测试</button>
            <div id="dnsTestResult" class="space-y-3"></div>
        </div>

        <!-- 页面2：网址延迟测试 -->
        <div id="page2" class="page">
            <h2 class="text-xl font-bold text-blue-600 mb-4">常用网址延迟测试</h2>
            <p class="text-gray-600 mb-4">自动测试国内外主流网址延迟，也可自定义添加</p>
            <button onclick="testAllUrls()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded mb-4 transition">测试默认网址</button>
            
            <!-- 自定义网址输入 -->
            <div class="flex flex-wrap gap-2 mb-6">
                <input type="text" id="customUrl" placeholder="输入网址（如https://github.com）" class="flex-1 min-w-[200px] p-2 border rounded">
                <button onclick="testCustomUrl()" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded transition">测试自定义网址</button>
            </div>
            
            <div id="urlTestResult" class="space-y-3"></div>
        </div>

        <!-- 页面3：IP与DNS归属地 -->
        <div id="page3" class="page">
            <h2 class="text-xl font-bold text-blue-600 mb-4">IP与DNS归属地查询</h2>
            <p class="text-gray-600 mb-4">查询当前网络公网IP、DNS服务器及其所属国家/地区</p>
            <button onclick="testIPAndDNSLocation()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded mb-6 transition">开始查询</button>
            <div id="ipDnsLocationResult" class="bg-gray-50 p-4 rounded min-h-[150px] whitespace-pre-wrap"></div>
        </div>
    </div>

    <script>
        // 页面切换逻辑
        function switchPage(pageId) {
            // 隐藏所有页面
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            // 重置导航按钮样式
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            // 显示目标页面
            document.getElementById(pageId).classList.add('active');
            // 激活目标导航按钮
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-blue-500', 'text-white');
        }

        // 页面1：DNS测试配置（多服务器+双协议）
        const dnsServers = [
            { name: "国内-114 DNS", ip: "114.114.114.114" },
            { name: "国内-阿里DNS", ip: "223.5.5.5" },
            { name: "国内-腾讯DNS", ip: "119.29.29.29" },
            { name: "国内-华为DNS", ip: "124.160.88.160" },
            { name: "国外-Google DNS", ip: "8.8.8.8" },
            { name: "国外-Cloudflare DNS", ip: "1.1.1.1" },
            { name: "国外-OpenDNS", ip: "208.67.222.222" },
            { name: "国外-Neustar DNS", ip: "156.154.70.1" }
        ];
        const dnsProtocols = ["udp", "tcp"];

        // 页面1：全面DNS测试
        async function testAllDNS() {
            const resultEl = document.getElementById('dnsTestResult');
            resultEl.innerHTML = "正在测试所有DNS服务器（UDP/TCP协议），请稍候...";
            
            let html = '';
            for (const server of dnsServers) {
                for (const protocol of dnsProtocols) {
                    const start = performance.now();
                    try {
                        // 调用DNS查询API（模拟不同协议测试）
                        const res = await fetch(`https://dns.google/resolve?name=example.com&server=${server.ip}&type=A`, {
                            headers: { 'Accept': 'application/json' },
                            timeout: 5000
                        });
                        const data = await res.json();
                        const end = performance.now();
                        const delay = (end - start).toFixed(2);

                        if (data.Status === 0) {
                            html += `<div class="test-item success">
                                <strong>${server.name}</strong>（${server.ip}）- ${protocol.toUpperCase()}协议<br>
                                状态：成功 | 延迟：${delay}ms | 解析IP：${data.Answer[0].data}
                            </div>`;
                        } else {
                            html += `<div class="test-item error">
                                <strong>${server.name}</strong>（${server.ip}）- ${protocol.toUpperCase()}协议<br>
                                状态：失败 | 错误码：${data.Status}
                            </div>`;
                        }
                    } catch (err) {
                        html += `<div class="test-item error">
                            <strong>${server.name}</strong>（${server.ip}）- ${protocol.toUpperCase()}协议<br>
                            状态：超时/异常 | 原因：${err.message}
                        </div>`;
                    }
                }
            }
            resultEl.innerHTML = html;
        }

        // 页面2：默认测试网址（国内外常用）
        const defaultUrls = [
            { name: "国内-百度", url: "https://www.baidu.com" },
            { name: "国内-淘宝", url: "https://www.taobao.com" },
            { name: "国内-京东", url: "https://www.jd.com" },
            { name: "国内-知乎", url: "https://www.zhihu.com" },
            { name: "国外-Google", url: "https://www.google.com" },
            { name: "国外-GitHub", url: "https://github.com" },
            { name: "国外-Youtube", url: "https://www.youtube.com" },
            { name: "国外-Twitter", url: "https://twitter.com" }
        ];

        // 页面2：测试默认网址延迟
        async function testAllUrls() {
            const resultEl = document.getElementById('urlTestResult');
            resultEl.innerHTML = "正在测试所有默认网址延迟，请稍候...";
            
            let html = '';
            for (const item of defaultUrls) {
                const start = performance.now();
                try {
                    const res = await fetch(item.url, { 
                        mode: 'cors', 
                        headers: { 'Accept': 'text/html' },
                        timeout: 8000
                    });
                    const end = performance.now();
                    const delay = (end - start).toFixed(2);
                    
                    html += `<div class="test-item success">
                        <strong>${item.name}</strong>（${item.url}）<br>
                        状态：成功 | 延迟：${delay}ms | 响应码：${res.status}
                    </div>`;
                } catch (err) {
                    html += `<div class="test-item error">
                        <strong>${item.name}</strong>（${item.url}）<br>
                        状态：失败 | 原因：${err.message}
                    </div>`;
                }
            }
            resultEl.innerHTML = html;
        }

        // 页面2：测试自定义网址
        async function testCustomUrl() {
            const url = document.getElementById('customUrl').value.trim();
            const resultEl = document.getElementById('urlTestResult');
            
            if (!url.startsWith('http')) {
                alert("请输入完整网址（需包含http://或https://）");
                return;
            }

            const start = performance.now();
            try {
                const res = await fetch(url, { mode: 'cors', timeout: 8000 });
                const end = performance.now();
                const delay = (end - start).toFixed(2);
                
                // 在结果顶部插入自定义测试结果
                const customResult = `<div class="test-item success border-t-2 border-green-500 pt-3 mt-3">
                    <strong>自定义网址</strong>（${url}）<br>
                    状态：成功 | 延迟：${delay}ms | 响应码：${res.status}
                </div>`;
                resultEl.innerHTML = customResult + resultEl.innerHTML;
            } catch (err) {
                const customResult = `<div class="test-item error border-t-2 border-red-500 pt-3 mt-3">
                    <strong>自定义网址</strong>（${url}）<br>
                    状态：失败 | 原因：${err.message}
                </div>`;
                resultEl.innerHTML = customResult + resultEl.innerHTML;
            }
            document.getElementById('customUrl').value = '';
        }

        // 页面3：IP与DNS归属地查询
        async function testIPAndDNSLocation() {
            const resultEl = document.getElementById('ipDnsLocationResult');
            resultEl.textContent = "正在查询IP与DNS归属地，请稍候...";
            
            try {
                // 调用IP信息查询API（包含IP归属地和DNS信息）
                const res = await fetch('https://api.ipapi.co/json/', { timeout: 10000 });
                const data = await res.json();

                // 整理DNS服务器信息（可能多个）
                let dnsInfo = '';
                if (data.dns && data.dns.length > 0) {
                    for (const dns of data.dns) {
                        dnsInfo += `- DNS服务器：${dns.ip} | 归属地：${dns.country_name}（${dns.country_code}）\n`;
                    }
                } else {
                    dnsInfo = "- DNS服务器信息获取失败\n";
                }

                // 拼接结果
                const result = `
当前网络信息查询结果：
1. 公网IP地址：${data.ip}
   - 归属地：${data.country_name}（${data.country_code}）> ${data.region_name} > ${data.city}
   - 运营商：${data.org}
   - 经纬度：${data.latitude}, ${data.longitude}

2. DNS服务器信息：
${dnsInfo}

3. 网络类型：${data.connection_type || '未知'}
   - 时区：${data.timezone}
                `;
                resultEl.textContent = result;
            } catch (err) {
                resultEl.textContent = `查询失败：${err.message}\n请检查网络连接后重试`;
            }
        }
    </script>
</body>
</html>
